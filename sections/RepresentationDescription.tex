\section{Representation and Description\buch{Ch. 11}\buchSeite{796-860}}
\label{sec:representationDescription}
\subsection{Representation\buchSeite{796}}
After the image segmentation, the boundaries need to be represented in a form, that is suitable for further processing.
\subsubsection{Boundary following\buchSeite{796}}
\begin{itemize}
\item Let the starting point, $b_0$ be the uppermost, leftmost point in the image that is labeled 1. Denote by $c_0$ the west neighbor of $b_0$ clearly, $c_0$ is a background point. Examine the 8-neighbors of $b_0$, starting at $c_0$ and procedding in a clockwise direction. Let $b_1$ denote the first neighor encountered whose value is 1, and let $c_1$ be the (background) point immediately preceding $b_1$ in the sequence. Store the localtions of $b_0$ and $b_1$ for use in Step 5.
\item Let $b=b_1$ and $c=c_1$
\item Let the 8-neighbors of $b$, starting at $c$ and proceeding in a clockwise direction, be denoted by $n_1,n_2,\ldots,n_8$. Find the first $n_k$ labeled 1.
\item Let $b=n_k$ and $c=n_{k-1}$
\item Repeat Steps 3 and 4 until $b=b_0$ and the next boundary point found is $b_1$. The sequence of $b$ points found when the algorithm stops constitutes the set of ordered boundary points
\end{itemize}
\begin{figure}[h]
	\centering
	\begin{subfigure}[b]{0.19\textwidth}
		\centering
		\adjustbox{scale=0.5}{\input{tikz/representation/BoundaryFollowing1}}
		\caption{Step 1}
	\end{subfigure}
	\begin{subfigure}[b]{0.19\textwidth}
		\centering
		\adjustbox{scale=0.5}{\input{tikz/representation/BoundaryFollowing2}}
		\caption{Step 2}
	\end{subfigure}
	\begin{subfigure}[b]{0.19\textwidth}
		\centering
		\adjustbox{scale=0.5}{\input{tikz/representation/BoundaryFollowing3}}
		\caption{Step 3}
	\end{subfigure}
	\begin{subfigure}[b]{0.19\textwidth}
		\centering
		\adjustbox{scale=0.5}{\input{tikz/representation/BoundaryFollowing4}}
		\caption{Step 4}
	\end{subfigure}
	\begin{subfigure}[b]{0.19\textwidth}
		\centering
		\adjustbox{scale=0.5}{\input{tikz/representation/BoundaryFollowing5}}
		\caption{Result}
	\end{subfigure}
	\caption{Boundary Following Algorithm}
\end{figure}
\subsubsection{Chain codes\buchSeite{798}}
Chain codes are used to represent a boundary by a connected sequence of straight-line segments of specified length and direction. The direction of each segment is coded using a number.
\begin{figure}[h]
	\centering
	\begin{subfigure}[b]{0.45\textwidth}
		\centering
		\adjustbox{scale=1}{\input{tikz/representation/4DirectionNumbers}}
		\caption{4-directional}
	\end{subfigure}
	\begin{subfigure}[b]{0.45\textwidth}
		\centering
		\adjustbox{scale=1}{\input{tikz/representation/8DirectionNumbers}}
		\caption{8-directional}
	\end{subfigure}
	\caption{Direction numbers for chain codes}
\end{figure}

Cain codes are quite sensitive to small disturbances. If they are on the pixel grid, they tend to result in rather long codes. Subsampling the boundary, i.e. going to a coarser grid results in a more robust and more efficient code at the expense of representation accuracy.\\
The resulting code depends on the starting point, which is not desirable. An easy trick is to circumvent this, is the convention to start at that point wich will result in a chain code that represents the smalles integer.\\
The representation can be made independent of rotation by using the first difference.
\subsubsection{Polygonal approximation using Minimum perimeter polygon MPP\buchSeite{801}}
A boundary is represented by a polygon. The goal is to use as few segments as possible, while still capturing the essential features of the boundary. There exist simple approximations which in practice are often good enough\\
\paragraph{Minimum perimeter polygon MPP}
\begin{figure}[h]
	\centering
	\begin{subfigure}[b]{0.3\textwidth}
		\centering
		\adjustbox{scale=0.4}{\input{tikz/representation/PolygonalApprox1}}
		\caption{Object Boundary}
	\end{subfigure}
	\begin{subfigure}[b]{0.3\textwidth}
		\centering
		\adjustbox{scale=0.4}{\input{tikz/representation/PolygonalApprox2}}
		\caption{Boundary enclodes by gray cells}
	\end{subfigure}
	\begin{subfigure}[b]{0.3\textwidth}
		\centering
		\adjustbox{scale=0.4}{\input{tikz/representation/PolygonalApprox3}}
		\caption{Minimum perimeter polygon}
	\end{subfigure}
	\caption{MPP obtained by boundary shrinking}
\end{figure}

\begin{figure}[h]
	\centering
	\begin{subfigure}[b]{0.3\textwidth}
		\centering
		\adjustbox{scale=0.4}{\input{tikz/representation/PolygonalApprox4}}
		\caption{Dark gray region resulting from enclosing the original boundary}
	\end{subfigure}
	\begin{subfigure}[b]{0.3\textwidth}
		\centering
		\adjustbox{scale=0.4}{\input{tikz/representation/PolygonalApprox5}}
		\caption{Convex (white) and concave (black) vertices}
	\end{subfigure}
	\begin{subfigure}[b]{0.3\textwidth}
		\centering
		\adjustbox{scale=0.4}{\input{tikz/representation/PolygonalApprox6}}
		\caption{Concave vertices displaced to their diagonal mirror locations}
	\end{subfigure}
	\caption{MPP obtained by boundary shrinking}
\end{figure}

\begin{enumerate}
\item Find all convex points (white dots) and concave points (black dots).
\item Mirror the concave points to their diagonal location in the outer wall.
\item The orientation (cw or ccw) of a sequence of three points will be necessary. This replaces the convec concave classification
\begin{enumerate}
\item $a=(x_1, y_1), b=(x_2, y_2), c=(x_3, y_3)$
\item $A=\begin{bmatrix}
	x_1 & y_1 & 1\\
  	x_2 & y_2 & 1\\
  	x_3 & y_3 & 1\\
\end{bmatrix}$
\item $det(A) =$ 
\begin{itemize}
\item $> 0$ if $(a, b, c)$ is a counterclockwise sequence
\item $= 0$ if the points are collinear
\item $< 0$ if $(a, b, c)$ is a clockwise sequence
\end{itemize}
\end{enumerate}
\item For notational convenience let $sgn(a,b,c) = det(A)$
\item Names
\begin{itemize}
\item $V_L$ are found vertices of the MPP
\item $V_K$ is the next possible candidate
\item $B_C$ is a black vertex
\item $W_C$ is a white vertex
\end{itemize} 
\item $V_K$ lies to the positive side of the line through pair ($V_L$, $W_C$), that is $sgn(V_L, W_C, V_K)>0$. If this condition holds, the next MPP vertex is $W_C$
\item $V_K$ lies to the negative side of the line through pair ($V_L$, $B_C$), that is $sgn(V_L, B_C, V_K)<0$. If this condition holds, the next MPP vertex is $B_C$.
\item $V_K$ lies on the negative side of the line through pair ($V_L$, $W_C$) or is collinear with it, that is $sgn(V_L, W_C, V_K) \le 0$. At the same time, $V_K$ lies on the positive side of the line through ($V_L$, $B_C$) or is collinear with it, that is $sgn(V_L, V_C, V_K) \ge 0$. If this condition holds, the next candidate MPP vertex is $V_K$; otherwise $B_C = V_K$
\item Continue with the next vertex in the list.
\end{enumerate}
\subsubsection{Other Polygonal Approximation Approaches\buchSeite{807}}
\paragraph{Merging\buchSeite{807}}
Points on the boundary are merged and a line is fitted to these points. If the fitting error becomes to large, a vertex is set and the procedure starts from the beginning.\\
\paragraph{Splitting\buchSeite{808}}
Here the idea is, to divide (split) a boundary segment until a threshold of an criterion is satisfied
\subsubsection{Signatures\buchSeite{808}}
A signature is a 1D function that represents a boundary. This results in a significant complexity reduction. There are several schemes:\\
\begin{itemize}
\item Find the centroid. The boundary is described as a function of the angle around this point.
\begin{itemize}
\item Rotational invariance: this can be achieved by selecting the point on the eigen axis that is farthest from the centroid.
\item Scaling invariance: this can be achieved by dividing the signature by its standard deviation.
\end{itemize}
\end{itemize}
\subsubsection{Boundary segments\buchSeite{810}}
The convex hull H of an arbitrary set S is the smallest convex set containing S. The difference $D=H-S$ is the convex deficiency. Follow the contour of S and mark the spots where the contour makes a transition into or out of D. These marking $\alpha$ (0...1) are relative to the total length of the contour D.\\
This is in theory invariant to:\\
\begin{itemize}
\item Rotation
\item Translation
\item Scaling
\end{itemize}
In practice, boundaries have some noise. Often smooting along the boundaries is used.\\
\subsubsection{Skeletons\buchSeite{812}}
Medial axis transform (MAT)
\begin{itemize}
\item Every point in the region finds its closest boundary point.
\item If a point in the region has two closest boundary points, it belongs to the skeleton of the region.
\item Direct implementation of this is computationally expensive.
\end{itemize}
Algorithms for efficient MAT iteratively delete boundary points subject to
\begin{enumerate}
\item keep end points
\item keep connectivity
\item do not erode that region excessively
\end{enumerate}
Thinning algorithm is 2 steps applied successively to border points\\
\begin{tikzpicture}
\matrix[3x3mask]{
p9 & p2 & p3 \\
p8 & p1 & p4 \\
p7 & p6 & p5 \\
};\\
\end{tikzpicture}\\
Step 1:\\
Flag for deletion if all of these conditions are satisfied:
\begin{enumerate}[label={\alph*)}]
\item $2\leq N(P_1)\leq 6$ with $N(p_1)=p_2 + p_3 + \ldots + p_9$
\item $T(p_1)=1$ where $T(p_1)$ is the number of $0-1$ transitions in the ordered sequence $p_2,p_3,\ldots ,p_8,p_9,p_2$
\item $p_2 \cdot p_4 \cdot p_6 = 0$
\item $p_4 \cdot p_6 \cdot p_8 = 0$
\end{enumerate}
The last conditions are satisfied simultaneously by the minimum set of values: $(p_4=0\ or\ p_6=0)\ or \ (p_2=0\ and \ p_8=0)$\\
After processing all boundary points, the marked ones are deleted\\
Step 2:\\
Simultaneous to Step 1 except the new conditions $c'$ and $d'$\\
\begin{enumerate}[label={\alph*)}]
\item $2\leq N(P_1)\leq 6$ with $N(p_1)=p_2 + p_3 + \ldots + p_9$
\item $T(p_1)=1$ where $T(p_1)$ is the number of $0-1$ transitions in the ordered sequence $p_2,p_3,\ldots ,p_8,p_9,p_2$
\end{enumerate}
\begin{enumerate}[label={\alph*')},resume]
\item $p_2 \cdot p_4 \cdot p_8 = 0$
\item $p_2 \cdot p_6 \cdot p_8 = 0$
\end{enumerate}

\subsection{Boundary Descriptors\buchSeite{815}}
\label{sec:boundaryDescriptors}
Having seen different representations of boundaries, the goal is now to develop descriptors for these boundaries.
\subsubsection{Simple Descriptors\buchSeite{815}}

\paragraph{Length}
\begin{itemize}
\item Number of pixels along a Boundary gives a rough approximation of its length
\item 8-directional Chain Code numbers of vertical and horizontal components plus $\sqrt{2}$ times the number of diagonal components, gives the exact length.
\end{itemize}
\paragraph{Diameter of boundary B}

\begin{flalign*}
& Diam(B)=\max\limits_{i,j}\left[D(p_i,p_j)\right] && \text{Points on boundary:} && p_i,p_j && \text{Distance measure:} && D 
\end{flalign*}

\paragraph{Major axis}
The line connecting the two extreme points of the boundary is called the major axis of the boundary.\\
\paragraph{Minor axis}
The line perpendicular to the major axis and of such length that a box passing through the outer four points of intersection ofthe boundary with the two axes completely encloses the boundary.
\paragraph{Eccentricity}
The ratio of the major to the minor axis is called the eccentricity of the boundary. This is a useful descriptor.
\paragraph{Curvature}
This is the rate of change of the slope in the boundary. i.e. this is a second derivative
\subsubsection{Shape numbers\buchSeite{816}}
The shape number of a boundary (based on 4-directional code) is defined as the first difference of smalles magnitude.\\
The order n of a shape number is defined as the number of digits in its representation.\\
One way of aligning the chain code grid with the boundary is to use the basic rectangle box based on the major and minor axes\\
\subsubsection{Fourier descriptors\buchSeite{818}}
The coordinates of the boundary represents a complex sampled signal wich can be represented as a complex vector 
\begin{align*}
s(k)=x(k)+jy(k) && k=0,1,2,\ldots,K-1
\end{align*} 
wich can be analyzed in the frequency domain.\\
The DFT of $s(k)$ is \begin{align*}
& \text{Fourier descriptors of the boundary:} && a(u)=\sum\limits_{k=0}^{K-1}s(k)e^{-j2\pi uk/K} && u=0,1,2,\ldots,K-1\\
& \text{Inverse Fourier transform:} && s(k)=\frac{1}{K}\sum\limits_{u=0}^{K-1}a(u)e^{j2\pi uk/K}
\end{align*} 

Since the high frequency components are responsible for the fine detail, using only a few Fourier descriptors results in a smoothing of the boundary.\\
Careful! you need to keep both sides of the spectrum, the formula in the book is wrong!\\

\textbf{Boundary Fourier Descriptor}

\begin{tabularx}{\textwidth}{XXX}
Transformation & Boundary & Fourier Descriptor \\\hline
Identity & $s(k)$ & $a(u)$ \\
Rotation & $s_r(k)=s(k)e^{j\theta}$& $a_r(u)=a(u)e^{j\theta}$ \\
Translation &$s_t(k)=s(k)+\Delta_{xy}$& $a_t(u)=a(u)+\Delta_{xy}\delta(u)$ \\
Scaling &$s_s(k)=\alpha s(k)$& $a_s(u)=\alpha a(u)$ \\
Starting point & $s_p(k)=s(k-k_0)$& $a_p(u)=a(u)e^{-j2\pi k_0u/K}$ \\
\end{tabularx}

\subsubsection{Statistical moments\buchSeite{821}}
\begin{itemize}
\item The boundary segment is rotated, so that a function of a single variable results
\item The amplitude of $g()$ can be treated as a discrete random variable v and a amplitude histogram $p(v_i)$ can be formed
\end{itemize}
From the histogram, the following shapes can be distinguished
\begin{itemize}
\item Mean
\item Variance
\item Skewness (this is a measure of asymmetry)
\item Kurtosis (peakedness)
\end{itemize}
The same can be done with skipping the histogram building.

\subsection{Regional descriptors\buchSeite{822}}
\subsubsection{Simple descriptors\buchSeite{822}}
\begin{itemize}
\item Area: Number of pixels
\item Perimeter: Lenght of boundary
\item Compactness: $Perimeter^2/area$
\item Circularity ratio $R_C=\frac{4\pi A}{P^2}$ where $A$ is the area of the region in question and $P$ the lenght of its perimeter
\item Mean, median, minimum, maximum of intensity
\item Etc.
\end{itemize}
\subsubsection{Topological descriptors\buchSeite{823}}
Topological descriptors are descriptors that do not change under rubber-sheet distortions. No tearing, noo folding allowed.\\
The number of holes $H$ and connected components $C$ in a figure can be used to define the Euler number $E=C-H$\\

\begin{figure}[h]
	\centering
	\adjustbox{scale=1.5}{\input{tikz/representation/PolygonalNetwork}}
	\caption{A region containing a polygonal network}
\end{figure}

\begin{itemize}
\item Number of vertices V
\item Number of edges Q
\item Number of faces F
\end{itemize}
Euler proved that $E=V-Q+F=C-H$
\subsubsection{Texture\buchSeite{827}}
Smoothness, coarseness, regularity etc.\\
There are three basic approaches to describe texture:\\
\paragraph{Statistical approaches\buchSeite{828}}
\begin{itemize}
\item Intenxity hisogram $p(z_i)$
\item Moment $\mu_n(z)=\sum\limits_{i=0}^{L-1}(z_i-m)^np(z_i)$ and mean $m=\sum\limits_{i=0}^{L-1}z_ip(z_i)$
\item The variance $\sigma ^2(z) =\mu_2 (z)$ is a measure of contrast, which can be used to establish descriptors of smoothness. It should be normalized to 0...1. $R(z)=1-\frac{1}{1+\sigma ^2(z)}$
\item A measure for unifomity $U(z)=\sum\limits_{i=0}^{L-1}p^2(z_i)$
\item Average entropy $e(z)=-\sum\limits_{i=0}^{L-1}p(z_i)log_2p(z_i)$
\end{itemize}
Note the approach with a Q operator described in the book and lecture!\\

\paragraph{Structural approaches\buchSeite{836}}
Some texture can be described as a repetition of a simple primitive. For such textures, a description based on rewriting rules is useful.
\paragraph{Spectral approaches\buchSeite{837}}
Good for periodic patterns\\
The energy spectrum $S(r,\theta)$ is analyzed in polar coordinates. It is analyzed for a fixed angle, $S_\theta(r)$ and/or a fixed radius $S_r(\theta)$. The advantage of this is, that these are 1D functions and therefore easier to deal with.\\
$S(r)=\sum\limits_{\theta = 0}^{\pi}S_\theta(r)$\\
$S(\theta)=\sum\limits_{r=1}^{R_0}S_r(\theta)$\\
\subsubsection{Moment Invariants\buchSeite{839}}
A set of seven moments for a given image region can be generated as regional descriptors. They are intrinsically invariant to translation, scale change, rotation and even mirroring except for a sign change.\\
\begin{tabular}{ll}
2D moments of order (p+q) & $m_{pq}=\sum\limits_{x=0}^{M-1}\sum\limits_{y=0}^{N-1}x^py^qf(x,y)$ \\
The central moments & $\mu_{pq}=\sum\limits_{x=0}^{M-1}\sum\limits_{y=0}^{N-1}(x-\overline{x})^p(y-\overline{y})^qf(x,y)$ \\
& $\overline{x}=\frac{m_{10}}{m_{00}}$ and $\overline{y}=\frac{m_{01}}{m_{00}}$ \\
Normalized central moments & $ \eta_{pq}=\frac{\mu_{pq}}{\mu_{00}^\gamma} $ with $\gamma=\frac{p+q}{2}+1 $ \\
\end{tabular}
The seven invariant moments:\\
\begin{align*}
\phi_1 =& \eta_{20}+\eta_{02} \\
\phi_2 =& (\eta_{20}-\eta_{02})^2+4\eta_{11}^2 \\
\phi_3 =& (\eta_{30}-3\eta_{12})^2+(3\eta_{21}-\eta_{03})^2 \\
\phi_4 =& (\eta_{30}+\eta_{12})^2+(\eta_{21}+\eta_{03})^2 \\
\phi_5 =& (\eta_{30}-3\eta_{12})(\eta_{30}+\eta_{12})[(\eta_{30}+\eta_{12})^2-3(\eta_{21}+\eta_{03})^2]+(3\eta_{21}-\eta_{03})(\eta_{21}+\eta_{03})[3(\eta_{30}+\eta_{12})^2-(\eta_{21}+\eta_{03})^2] \\
\phi_6 =& (\eta_{20}-\eta_{02})[(\eta_{30}+\eta_{12})^2-(\eta_{21}+\eta_{03})^2]+4\eta_{11}(\eta_{30}+\eta_{12})(\eta_{21}+\eta_{03})\\
\phi_7 =& (3\eta_{21}-\eta_{03})(\eta_{30}+\eta_{12})[(\eta_{30}+\eta_{12})^2-3(\eta_{21}+\eta_{03})^2]+(3\eta_{12}-\eta_{30})(\eta_{21}+\eta_{03})[3(\eta_{30}+\eta_{12})^2-(\eta_{21}+\eta_{03})^2]
\end{align*}

\subsection{Use of Principal Components for Description\buchSeite{842}}
Principle component analysis (PCA) is a very general tool. It is applicable to boundaries and regions but also to color images and multispectral images. A given pixel in a multispectral image with n spectral components can be written as a vector containing these components. It is assumed that the components are random variables and hence these pixels are random vectors.
\begin{align*}
& x = \left[\begin{array}{c} x_1 \\ x_2 \\ \vdots \\ x_n \end{array}\right]&&\\
& m_x = E\{x\} = \frac{1}{K}\sum\limits_{k=1}^{K}x_k&&\\
& C_x = E\{(x-m_x)(x-m_x)^T\}=\frac{1}{K}\sum\limits_{k=1}^{K}x_kx_k^T-m_xm_x^T
\end{align*}

Since the covariance matrix is real and symmetric, there exists a set of n orthonormal eigenvectors $e_i$ and corresponding eigenvalues $\lambda_i$\\
$Ce_i=\lambda_ie_i$\\
The eigenvectors can be arranged into a matrix A:\\
$A=[e_1^T, e_2^T, ..., e_n^T]$\\
Now A is used as a transformation matrix to map the vectors x into the vectors y. This is called the Hotelling transform\\
$y=A(x-m_x)$\\
Clearly, the mean vector of these new y vectors is zero $m_y=E\{y\}=0$\\
$C_y=AC_xA^T=\left[
\begin{matrix}
 \lambda_1 & & & 0 \\
 & \lambda_2 & & \\
 & & ... & \\
 0 & & & \lambda_n
\end{matrix}\right]	$\\
Hottelling transformation: $y=A(x-m_x)$\\
Hotteling transform can be inverted: $x=A^Ty+m_x$\\

\subsection{Relational Descriptors\buchSeite{852}}

\paragraph{Rewriting Rules:}
Example:
\begin{align*}
& 1 && \text{Start} && S \rightarrow aA\\
& 2 && \text{got to 1 or to 3} &&  A \rightarrow bS \\
& 3 && \text{end} &&  A \rightarrow b \\
\end{align*}
\paragraph{Directed line segments:} The idea is, that section of an image are described by directed line segments

\begin{itemize}
\item There needs to be a set of
operations acting on the
primitives, such that a region or a
boundary can be described
\item The abstracted primitives need
some specific primitives, which
contain all directions
\end{itemize}
\begin{figure}[h]
	\centering
	\begin{subfigure}[b]{0.45\textwidth}
		\centering
		\adjustbox{scale=1}{\input{tikz/representation/AbstractedPrimitives}}
		\caption{Abstracted Primitives}
	\end{subfigure}
	\begin{subfigure}[b]{0.45\textwidth}
		\centering
		\adjustbox{scale=1}{\input{tikz/representation/PrimitivesOperations}}
		\caption{Operations among primitives}
	\end{subfigure}
	\caption{Primitives}
\end{figure}

\begin{align*}
& a+b &&\\
& a-b  &&\\
& a \times b &&\\
& a\ast b &&\\
\end{align*}

\paragraph{Tree descriptors}
\begin{figure}[h]
	\centering
	\begin{subfigure}[b]{0.45\textwidth}
		\centering
		\adjustbox{scale=1}{\input{tikz/representation/CompositeRegion}}
		\caption{Simple composite region}
	\end{subfigure}
	\begin{subfigure}[b]{0.45\textwidth}
		\centering
		\adjustbox{scale=1}{\input{tikz/representation/TreeRepresentation}}
		\caption{Tree representation}
	\end{subfigure}
	\caption{Tree descriptors}
\end{figure}
